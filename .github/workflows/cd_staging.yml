name: Deploy to staging
on: 
  push:
    branches: [main]

jobs: 
 redeploy_everything:
  runs-on: ubuntu-latest
  name: Deploying everything to staging cluster  
  steps: 
    - run: |
        echo "${{secrets.SSH_PRIVATE_KEY}}" > ~/ssh_key
        mkdir -p  /home/runner/.ssh
        ls /home/runner/.ssh
        touch /home/runner/.ssh/known_hosts
        echo "${{secrets.KNOWN_HOSTS}}" > /home/runner/.ssh/known_hosts
        chmod 700 /home/runner/ssh_key
        chmod 700 /home/runner/.ssh
        ssh -i ~/ssh_key root@157.245.107.213 -t "cd TurboRepo-Devops/ && git pull origin main && pnpm install && pnpm run build && pm2 restart fe-server && pm2 restart http-server && pm2 restart ws-server"
    