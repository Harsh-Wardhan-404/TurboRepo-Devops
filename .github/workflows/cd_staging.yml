name: Deploy to staging
on: 
  push:
    branches:
      - main

jobs: 
 redeploy_everything:
  runs-on: ubuntu-latest
  name: Deploying everything to staging cluster  
  steps: 
    - run: |
        echo ${{secrets.SSH_PRIVATE_KEY}} > ~/ssh_key
        ssh -i ~/ssh_key root@157.245.107.213
        cd TurboRepo-Devops && git pull
        pnpm install
        pnpm run build
        pm2 restart fe-server
        pm2 restart http-server
        pm2 restart ws-server
    